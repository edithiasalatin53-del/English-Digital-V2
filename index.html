<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Guru SMP - Om Guru</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        :root {
            --primary: #f97316;
            --primary-glow: rgba(249, 115, 22, 0.4);
            --secondary: #3b82f6;
            --bg-dark: #050505;
            --bg-surface: rgba(15, 23, 42, 0.6);
            --bg-card: rgba(15, 23, 42, 0.7);
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --border: rgba(255, 255, 255, 0.08);
            --success: #22c55e;
            --danger: #ef4444;
            --warning: #eab308;
            --info: #3b82f6;
            --bolos: #d946ef;
            --radius: 16px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; }
        
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-dark);
            color: var(--text-main);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
        }

        .bg-animation-container {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; overflow: hidden;
            background: radial-gradient(circle at 50% 0%, #1e293b 0%, #050505 100%);
        }

        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.4;
            animation: float 20s infinite alternate cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .orb-1 { width: 600px; height: 600px; background: var(--primary); top: -200px; left: -100px; }
        .orb-2 { width: 500px; height: 500px; background: var(--secondary); bottom: -150px; right: -100px; animation-delay: -5s; }
        .orb-3 { width: 400px; height: 400px; background: #10b981; top: 50%; left: 50%; transform: translate(-50%, -50%); opacity: 0.2; animation-delay: -10s; }

        @keyframes float {
            0% { transform: translate(0, 0) scale(1) rotate(0deg); }
            33% { transform: translate(30px, -50px) scale(1.1) rotate(10deg); }
            66% { transform: translate(-20px, 20px) scale(0.9) rotate(-5deg); }
            100% { transform: translate(0, 0) scale(1) rotate(0deg); }
        }

        #app { display: flex; flex-direction: column; min-height: 100vh; position: relative; z-index: 1; }
        
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary); }

        header {
            position: sticky; top: 0; z-index: 100;
            background: rgba(5, 5, 5, 0.8); backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
        }
        
        .header-content {
            max-width: 1400px; margin: 0 auto; padding: 20px;
            display: flex; align-items: center; justify-content: space-between;
            flex-wrap: wrap; gap: 20px;
        }

        .profile-left { display: flex; align-items: center; gap: 20px; }
        .profile-img {
            width: 65px; height: 65px; border-radius: 50%; object-fit: cover;
            border: 2px solid rgba(255,255,255,0.1);
            box-shadow: 0 0 20px var(--primary-glow);
            transition: transform 0.3s ease;
        }
        .profile-img:hover { transform: scale(1.05) rotate(5deg); }
        
        .profile-info h1 {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.5rem; font-weight: 700;
            background: linear-gradient(135deg, #fff 0%, #94a3b8 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .profile-info p { color: var(--text-muted); font-size: 0.95rem; margin-top: 4px; }

        .date-display { text-align: right; background: rgba(255,255,255,0.03); padding: 10px 16px; border-radius: 12px; border: 1px solid var(--border); }
        .date-display div:first-child { color: var(--text-muted); font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 2px; }
        .date-display div:last-child { color: var(--primary); font-weight: 600; font-size: 1.1rem; }

        nav {
            background: rgba(10, 10, 10, 0.6); backdrop-filter: blur(12px);
            position: sticky; top: 105px; z-index: 90;
            border-bottom: 1px solid var(--border); padding: 12px 0;
        }
        .nav-content { max-width: 1400px; margin: 0 auto; padding: 0 20px; overflow-x: auto; scrollbar-width: none; }
        .nav-content::-webkit-scrollbar { display: none; }
        .nav-grid { display: flex; gap: 12px; min-width: max-content; }
        .nav-btn {
            padding: 10px 20px; border: 1px solid transparent; border-radius: 12px;
            background: rgba(255, 255, 255, 0.03); color: var(--text-muted);
            cursor: pointer; white-space: nowrap; font-size: 0.9rem; font-weight: 500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex; align-items: center; gap: 8px; font-family: 'Inter', sans-serif;
        }
        .nav-btn i { font-size: 1.1rem; transition: transform 0.3s; }
        .nav-btn:hover { background: rgba(255,255,255,0.08); color: #fff; border-color: var(--border); }
        .nav-btn:hover i { transform: translateY(-2px); }
        .nav-btn.active { background: var(--primary); color: #fff; border-color: transparent; box-shadow: 0 4px 20px var(--primary-glow); font-weight: 600; }

        main { flex: 1; max-width: 1400px; width: 100%; margin: 0 auto; padding: 30px 20px; }
        
        .section-title { font-family: 'Space Grotesk', sans-serif; font-size: 2rem; margin-bottom: 30px; color: #fff; display: flex; align-items: center; gap: 15px; letter-spacing: -0.5px; }
        .section-title i { color: var(--primary); font-size: 1.8rem; }
        
        .content-section { display: none; opacity: 0; transform: translateY(20px); }
        .content-section.active { display: block; animation: fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

        .card {
            background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius);
            padding: 28px; margin-bottom: 24px; backdrop-filter: blur(12px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative; overflow: hidden;
        }
        
        .card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent); opacity: 0.5; }
        .card:hover { transform: translateY(-4px); box-shadow: 0 15px 40px rgba(0,0,0,0.3); border-color: rgba(255,255,255,0.15); }
        .card h3 { color: #fff; font-size: 1.2rem; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; font-weight: 600; }
        .card h3 i { color: var(--primary); }

        .btn {
            padding: 12px 24px; border: none; border-radius: 10px; cursor: pointer;
            font-weight: 600; font-size: 0.95rem;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex; align-items: center; gap: 10px;
            text-decoration: none; font-family: 'Inter', sans-serif;
        }
        .btn:active { transform: scale(0.96); }
        .btn-primary { background: linear-gradient(135deg, var(--primary) 0%, #ea580c 100%); color: #fff; box-shadow: 0 4px 15px var(--primary-glow); border: 1px solid rgba(255,255,255,0.1); }
        .btn-primary:hover { box-shadow: 0 6px 20px var(--primary-glow); transform: translateY(-2px); }
        .btn-secondary { background: rgba(255,255,255,0.06); color: #fff; border: 1px solid var(--border); }
        .btn-secondary:hover { background: rgba(255,255,255,0.1); border-color: rgba(255,255,255,0.2); }
        .btn-danger { background: rgba(239, 68, 68, 0.1); color: var(--danger); border: 1px solid rgba(239, 68, 68, 0.3); }
        .btn-danger:hover { background: var(--danger); color: white; }

        .form-group { margin-bottom: 18px; }
        .form-label { display: block; margin-bottom: 8px; color: var(--text-muted); font-size: 0.9rem; font-weight: 500; }
        
        .form-input, .form-select, .form-textarea {
            width: 100%; background: rgba(0, 0, 0, 0.3); border: 1px solid var(--border);
            padding: 14px 16px; color: #fff; border-radius: 10px;
            font-family: inherit; font-size: 0.95rem; transition: all 0.3s ease;
        }
        .form-input:focus, .form-select:focus, .form-textarea:focus { border-color: var(--primary); background: rgba(0, 0, 0, 0.5); box-shadow: 0 0 0 3px var(--primary-glow); }
        .form-select option { background: #1e293b; color: #fff; }

        .table-container { overflow-x: auto; border-radius: 12px; border: 1px solid var(--border); background: rgba(0,0,0,0.2); }
        table { width: 100%; border-collapse: collapse; min-width: 400px; }
        th { text-align: left; padding: 14px 18px; background: rgba(249, 115, 22, 0.05); color: var(--primary); font-weight: 600; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid var(--border); }
        td { padding: 14px 18px; border-bottom: 1px solid rgba(255,255,255,0.05); color: var(--text-main); font-size: 0.9rem; }
        tr:last-child td { border-bottom: none; }
        tr:hover td { background: rgba(255,255,255,0.02); }

        .jam-checkbox-container { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px; }
        .jam-checkbox-label {
            background: rgba(255,255,255,0.03); padding: 8px 14px; border-radius: 8px;
            cursor: pointer; user-select: none; border: 1px solid var(--border);
            transition: all 0.2s;
        }
        .jam-checkbox-label:hover { background: rgba(255,255,255,0.07); border-color: rgba(255,255,255,0.2); }
        .jam-checkbox-label input { display: none; }
        .jam-checkbox-label span { color: var(--text-muted); font-size: 0.9rem; font-weight: 500; }
        .jam-checkbox-label input:checked + span { color: white; font-weight: 600; }
        .jam-checkbox-label:has(input:checked) { background: var(--primary); border-color: var(--primary); box-shadow: 0 2px 10px var(--primary-glow); }

        .student-list-container { max-height: 500px; overflow-y: auto; border: 1px solid var(--border); border-radius: 12px; background: rgba(0,0,0,0.2); padding: 4px; }
        .student-item {
            display: flex; flex-direction: row; align-items: center; justify-content: space-between; gap: 15px;
            background: rgba(255,255,255,0.02); padding: 12px 16px; margin-bottom: 4px;
            border-radius: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);
            transition: all 0.2s;
        }
        .student-item:last-child { border-bottom: none; margin-bottom: 0; }
        .student-item:hover { background: rgba(255,255,255,0.05); }
        .student-item > div:first-child { font-size: 0.95rem; font-weight: 500; color: var(--text-main); flex-grow: 1; }
        .status-group { display: flex; gap: 6px; flex-shrink: 0; }
        
        .status-btn {
            width: 36px; height: 36px; border: none; border-radius: 8px;
            background: rgba(255,255,255,0.05); color: #64748b; cursor: pointer;
            font-weight: 700; font-size: 0.9rem;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.2s; border: 1px solid transparent;
        }
        .status-btn:hover { background: rgba(255,255,255,0.1); color: white; transform: translateY(-1px); }

        .active-hadir { background: rgba(34, 197, 94, 0.15) !important; color: var(--success) !important; border-color: rgba(34,197,94,0.3) !important; }
        .active-sakit { background: rgba(234, 179, 8, 0.15) !important; color: var(--warning) !important; border-color: rgba(234,179,8,0.3) !important; }
        .active-izin { background: rgba(59, 130, 246, 0.15) !important; color: var(--info) !important; border-color: rgba(59,130,246,0.3) !important; }
        .active-alpa { background: rgba(239, 68, 68, 0.15) !important; color: var(--danger) !important; border-color: rgba(239,68,68,0.3) !important; }
        .active-bolos { background: rgba(217, 70, 239, 0.15) !important; color: var(--bolos) !important; border-color: rgba(217,70,239,0.3) !important; }

        .student-count-footer { text-align: center; padding: 10px; margin-top: 5px; font-size: 0.85rem; color: var(--text-muted); border-top: 1px solid var(--border); }

        .jadwal-grid, .nilai-meta-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 768px) { .jadwal-grid, .nilai-meta-grid { grid-template-columns: 1fr; } .section-title { font-size: 1.5rem; } }

        .bahan-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .bahan-card {
            background: rgba(255,255,255,0.02); border: 1px solid var(--border);
            border-radius: 12px; padding: 24px; transition: all 0.3s ease;
            position: relative; display: flex; flex-direction: column; height: 100%;
        }
        .bahan-card:hover { transform: translateY(-5px); border-color: var(--primary); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .bahan-card h4 { color: #fff; font-size: 1.1rem; margin-bottom: 12px; padding-right: 30px; line-height: 1.4; }
        .bahan-card p { color: var(--text-muted); font-size: 0.9rem; margin-bottom: 20px; line-height: 1.5; flex-grow: 1; }
        .delete-btn { position: absolute; top: 18px; right: 18px; background: transparent; border: none; color: #64748b; cursor: pointer; font-size: 1.2rem; padding: 5px; border-radius: 4px; transition: all 0.2s; }
        .delete-btn:hover { color: var(--danger); transform: scale(1.1); }

        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            display: flex; align-items: center; justify-content: center;
            z-index: 1000; backdrop-filter: blur(8px);
            opacity: 0; visibility: hidden; transition: all 0.3s;
        }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-card {
            background: linear-gradient(145deg, #1e293b, #0f172a);
            padding: 40px; border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            text-align: center;
            width: 90%; max-width: 420px;
            transform: translateY(30px) scale(0.95);
            transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
        .modal-overlay.active .modal-card { transform: translateY(0) scale(1); }
        .password-input { text-align: center; font-size: 1.5rem; letter-spacing: 5px; margin: 20px 0; }
        .modal-actions { margin-top: 24px; display: flex; gap: 12px; justify-content: center; }
        .modal-actions .btn { flex: 1; justify-content: center; }

        #toast-container { position: fixed; top: 20px; right: 20px; z-index: 2000; display: flex; flex-direction: column; gap: 12px; }
        .toast {
            min-width: 320px; padding: 16px 20px; border-radius: 12px;
            background: #1e293b; color: #fff; border-left: 4px solid var(--primary);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
            display: flex; align-items: center; justify-content: space-between;
            animation: slideInRight 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }
        .toast.success { border-left-color: var(--success); }
        .toast.error { border-left-color: var(--danger); }
        .toast.info { border-left-color: var(--info); }
        @keyframes slideInRight { from { opacity: 0; transform: translateX(100px); } to { opacity: 1; transform: translateX(0); } }

        .hidden { display: none !important; }
        .tab-nav { display: flex; gap: 12px; margin-bottom: 24px; border-bottom: 1px solid var(--border); padding-bottom: 16px; overflow-x: auto; }
        
        .profile-header-card { display: flex; align-items: center; gap: 30px; padding: 40px; flex-wrap: wrap; }
        .profile-avatar { width: 140px; height: 140px; border-radius: 50%; object-fit: cover; border: 4px solid var(--primary); box-shadow: 0 0 30px var(--primary-glow); }
        .profile-header-info h1 { font-family: 'Space Grotesk', sans-serif; font-size: 2rem; margin-bottom: 8px; }
        .profile-header-info p { font-size: 1.1rem; color: var(--text-muted); margin-bottom: 15px; }
        .info-badges { display: flex; gap: 10px; flex-wrap: wrap; }
        .badge { display: inline-flex; align-items: center; gap: 6px; background: rgba(255,255,255,0.05); border: 1px solid var(--border); padding: 6px 12px; border-radius: 20px; font-size: 0.9rem; color: var(--text-main); }
        .badge i { color: var(--primary); }

        .edu-timeline { position: relative; padding-left: 30px; border-left: 2px solid rgba(255,255,255,0.1); margin-top: 20px; }
        .edu-item { position: relative; margin-bottom: 30px; }
        .edu-item:last-child { margin-bottom: 0; }
        .edu-item::before { content: ''; position: absolute; left: -36px; top: 5px; width: 10px; height: 10px; border-radius: 50%; background: var(--primary); box-shadow: 0 0 10px var(--primary-glow); }
        .edu-item h4 { color: var(--primary); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px; }
        .edu-item .title { font-size: 1.1rem; font-weight: 600; color: #fff; margin-bottom: 4px; }
        .edu-item .subtitle { font-size: 0.95rem; color: var(--text-muted); line-height: 1.5; }

        .competency-item {
            background: rgba(255,255,255,0.02);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        .competency-item:hover {
            background: rgba(255,255,255,0.04);
            border-color: rgba(255,255,255,0.15);
        }
        .competency-item h4 {
            color: #fff;
            font-size: 1rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .competency-item h4 i { color: var(--primary); font-size: 1.2rem; }
        .competency-item p { color: var(--text-muted); font-size: 0.95rem; line-height: 1.6; }

        .quote-box { 
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.1), rgba(0,0,0,0.2)); 
            border-left: 4px solid var(--primary); 
            padding: 24px; 
            border-radius: 0 12px 12px 0; 
            font-style: italic; 
            margin-top: 10px; 
            font-size: 1.05rem;
            line-height: 1.7;
            color: var(--text-main);
        }
        .quote-box .author { 
            display: block; 
            margin-top: 16px; 
            font-style: normal; 
            font-weight: 600; 
            color: var(--primary); 
            font-size: 0.95rem; 
        }
        .quote-box .author span {
            display: block;
            font-weight: 400;
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-top: 4px;
        }

        /* Silabus Styles */
        .silabus-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
        }
        .silabus-info-item {
            background: rgba(255,255,255,0.02);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--border);
        }
        .silabus-info-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }
        .silabus-info-value {
            font-size: 1rem;
            font-weight: 600;
            color: #fff;
        }

        .chapter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .chapter-card {
            background: rgba(255,255,255,0.02);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            position: relative;
            transition: all 0.3s ease;
        }
        .chapter-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .chapter-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 18px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }
        .chapter-number {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, var(--primary), #ea580c);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
            color: white;
            flex-shrink: 0;
        }
        .chapter-title {
            font-size: 1.15rem;
            font-weight: 600;
            color: #fff;
            line-height: 1.3;
        }
        .chapter-objective {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 15px;
            line-height: 1.5;
            padding-left: 12px;
            border-left: 3px solid var(--info);
        }
        .chapter-detail-box {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .chapter-detail-title {
            font-size: 0.85rem;
            color: var(--primary);
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .chapter-list {
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .chapter-list li {
            position: relative;
            padding-left: 18px;
            margin-bottom: 5px;
            font-size: 0.9rem;
            color: var(--text-main);
        }
        .chapter-list li::before {
            content: 'â€¢';
            position: absolute;
            left: 5px;
            color: var(--text-muted);
        }
        .chapter-footer {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            font-size: 0.85rem;
            color: var(--text-muted);
            padding-top: 12px;
            border-top: 1px solid var(--border);
        }
        .chapter-footer span {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        @media print { .bg-animation-container, nav, .no-print, .tab-nav, .btn, .modal-overlay { display: none !important; } body, .card { background: #fff !important; color: #000 !important; border-color: #e2e8f0 !important; box-shadow: none !important; } }

        @media (prefers-reduced-motion: reduce) {
            .orb, .toast, .modal-card, .card, .btn, .nav-btn { animation: none !important; transition: none !important; }
        }
    </style>
</head>
<body>
    <div class="bg-animation-container">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
    </div>

    <div id="app">
        <header>
            <div class="header-content">
                <div class="profile-left">
                    <img src="https://picsum.photos/seed/omguru/200/200.jpg" alt="Profile" class="profile-img">
                    <div class="profile-info">
                        <h1>Om Guru</h1>
                        <p>Edithia Opasanta Salatin, S.Pd.I.</p>
                    </div>
                </div>
                <div class="date-display">
                    <div id="current-day">-</div>
                    <div id="current-date">-</div>
                </div>
            </div>
        </header>

        <nav class="no-print">
            <div class="nav-content">
                <div class="nav-grid">
                    <button class="nav-btn active" onclick="showSection('profil', this)"><i class="ph ph-user-circle"></i> Profil</button>
                    <button class="nav-btn" onclick="showSection('jadwal', this)"><i class="ph ph-calendar"></i> Jadwal</button>
                    <button class="nav-btn" onclick="showSection('silabus', this)"><i class="ph ph-book-open"></i> Silabus</button>
                    <button class="nav-btn" onclick="showSection('bahan-ajar', this)"><i class="ph ph-desktop"></i> Bahan Ajar</button>
                    <button class="nav-btn" onclick="showSection('jurnal', this)"><i class="ph ph-journal"></i> Jurnal</button>
                    <button class="nav-btn" onclick="showSection('asesmen', this)"><i class="ph ph-clipboard-text"></i> Asesmen</button>
                    <button class="nav-btn" onclick="showSection('buku-nilai', this)"><i class="ph ph-exam"></i> Buku Nilai</button>
                    <button class="nav-btn" onclick="showSection('guru-wali', this)"><i class="ph ph-users-three"></i> Guru Wali</button>
                </div>
            </div>
        </nav>

        <main>
            <!-- Profil -->
            <section id="profil" class="content-section active">
                <div class="section-title"><i class="ph ph-user-circle-dashed"></i> Profil Guru</div>
                
                <div class="card profile-header-card">
                    <img src="https://picsum.photos/seed/omguru/200/200.jpg" alt="Edithia Opasanta Salatin" class="profile-avatar">
                    <div class="profile-header-info">
                        <h1>Edithia Opasanta Salatin, S.Pd.I.</h1>
                        <p>English Teacher</p>
                        <div class="info-badges">
                            <span class="badge"><i class="ph ph-graduation-cap"></i> UPTD SMP Negeri 6 Metro</span>
                            <span class="badge"><i class="ph ph-map-pin"></i> Metro City, Lampung</span>
                            <span class="badge"><i class="ph ph-clock"></i> 15+ Years Experience</span>
                        </div>
                    </div>
                </div>

                <!-- About Me -->
                <div class="card">
                    <h3><i class="ph ph-chat-circle-text"></i> About Me</h3>
                    <p style="color: var(--text-muted); line-height: 1.8;">I am Edithia Opasanta Salatin, S.Pd.I., an educator born and raised in Metro City. With my dedication to teaching English, I have a vision to build quality education in my homeland through communicative and character-based language teaching. As a graduate of STAIN Jurai Siwo Metro with a degree in S.Pd.I., I combine linguistic expertise with tarbiyah (Islamic education) values in every learning process.</p>
                </div>

                <!-- Educational Background -->
                <div class="card">
                    <h3><i class="ph ph-graduation-cap"></i> Educational Background</h3>
                    <p style="color: var(--text-muted); font-size: 0.95rem; line-height: 1.6;">As a local son who completed all levels of education in leading schools in Metro City, I have a deep understanding of the character of students in this environment:</p>
                    <div class="edu-timeline">
                        <div class="edu-item">
                            <h4>S1 - Higher Education</h4>
                            <div class="title">Bachelor of English Education, Department of Tarbiyah</div>
                            <div class="subtitle">STAIN Jurai Siwo Metro (Now IAIN Metro)</div>
                        </div>
                        <div class="edu-item">
                            <h4>SMA - Senior High School</h4>
                            <div class="title">SMA Negeri 3 Metro</div>
                            <div class="subtitle">Metro City, Lampung</div>
                        </div>
                        <div class="edu-item">
                            <h4>SMP - Junior High School</h4>
                            <div class="title">SMP Negeri 2 Metro</div>
                            <div class="subtitle">Metro City, Lampung</div>
                        </div>
                        <div class="edu-item">
                            <h4>SD - Elementary School</h4>
                            <div class="title">SD Pertiwi Teladan Metro</div>
                            <div class="subtitle">Metro City, Lampung</div>
                        </div>
                    </div>
                </div>

                <!-- Experience & Competencies -->
                <div class="card">
                    <h3><i class="ph ph-briefcase"></i> Experience & Competencies</h3>
                    <p style="color: var(--text-muted); margin-bottom: 20px; font-size: 0.95rem; line-height: 1.6;">For more than 15 years, I have consistently taught English, managed classes with an interactive approach, and adapted to various changes in the national education curriculum.</p>
                    
                    <div class="competency-item">
                        <h4><i class="ph ph-book-open"></i> Pedagogical Expertise</h4>
                        <p>Integrating modern language teaching methods that include Listening, Speaking, Reading, and Writing with the approach of akhlakul karimah (noble character) values.</p>
                    </div>
                    
                    <div class="competency-item">
                        <h4><i class="ph ph-globe-hemisphere-west"></i> Local Character Understanding</h4>
                        <p>My educational background, which is entirely in Metro, makes it easier for me to build effective connections and communication with students and parents.</p>
                    </div>
                </div>

                <!-- Teaching Philosophy -->
                <div class="card">
                    <h3><i class="ph ph-lightbulb"></i> Teaching Philosophy</h3>
                    <div class="quote-box">
                        "Educating is a calling of the heart to build civilization. As an educator in the City of Education (Metro), I am committed to guiding my students to become individuals who are proficient in global languages without forgetting their cultural roots and local identity."
                        <span class="author">
                            - Edithia Opasanta Salatin, S.Pd.I.
                            <span>English Teacher at UPTD SMP Negeri 6 Metro</span>
                        </span>
                    </div>
                </div>
            </section>

            <!-- Silabus -->
            <section id="silabus" class="content-section">
                <div class="section-title"><i class="ph ph-book-bookmark"></i> Silabus Bahasa Inggris Kelas 7</div>
                
                <!-- Informasi Umum -->
                <div class="card">
                    <h3><i class="ph ph-info"></i> Informasi Umum</h3>
                    <div class="silabus-info-grid">
                        <div class="silabus-info-item">
                            <div class="silabus-info-label">Mata Pelajaran</div>
                            <div class="silabus-info-value">Bahasa Inggris</div>
                        </div>
                        <div class="silabus-info-item">
                            <div class="silabus-info-label">Kelas/Semester</div>
                            <div class="silabus-info-value">VII / 1 & 2</div>
                        </div>
                        <div class="silabus-info-item">
                            <div class="silabus-info-label">Buku Referensi</div>
                            <div class="silabus-info-value">English for Nusantara - Kelas 7</div>
                        </div>
                        <div class="silabus-info-item">
                            <div class="silabus-info-label">Penerbit</div>
                            <div class="silabus-info-value">Pusat Kurikulum dan Perbukuan</div>
                        </div>
                    </div>
                </div>

                <!-- Chapter Grid -->
                <div class="chapter-grid">
                    <!-- Chapter 1 -->
                    <div class="chapter-card">
                        <div class="chapter-header">
                            <div class="chapter-number">1</div>
                            <div class="chapter-title">About Me</div>
                        </div>
                        <div class="chapter-objective">
                            <strong>Tujuan Pembelajaran:</strong> Siswa mampu memperkenalkan diri dan orang lain dengan menyebutkan identitas (nama, usia, asal, dll)
                        </div>
                        <div class="chapter-detail-box">
                            <div class="chapter-detail-title"><i class="ph ph-target"></i> Materi Pokok</div>
                            <ul class="chapter-list">
                                <li>Personal information</li>
                                <li>Introducing yourself and others</li>
                                <li>Asking and answering about identity</li>
                                <li>Pronoun: I, You, He, She, We, They</li>
                            </ul>
                        </div>
                        <div class="chapter-footer">
                            <span><i class="ph ph-clock" style="color: var(--primary);"></i> 12 JP (6 pertemuan)</span>
                            <span><i class="ph ph-note-pencil" style="color: var(--success);"></i> Praktik, Tertulis, Presentasi</span>
                        </div>
                    </div>

                    <!-- Chapter 2 -->
                    <div class="chapter-card">
                        <div class="chapter-header">
                            <div class="chapter-number">2</div>
                            <div class="chapter-title">Culinary and Me</div>
                        </div>
                        <div class="chapter-objective">
                            <strong>Tujuan Pembelajaran:</strong> Siswa mampu menyebutkan dan mendeskripsikan makanan favorit serta kebiasaan makan
                        </div>
                        <div class="chapter-detail-box">
                            <div class="chapter-detail-title"><i class="ph ph-target"></i> Materi Pokok</div>
                            <ul class="chapter-list">
                                <li>Names of food and drinks</li>
                                <li>Describing favorite food</li>
                                <li>Expressing likes and dislikes</li>
                                <li>Simple Present Tense (like/love/hate)</li>
                            </ul>
                        </div>
                        <div class="chapter-footer">
                            <span><i class="ph ph-clock" style="color: var(--primary);"></i> 12 JP (6 pertemuan)</span>
                            <span><i class="ph ph-note-pencil" style="color: var(--success);"></i> Kuis, Presentasi, Dialog</span>
                        </div>
                    </div>

                    <!-- Chapter 3 -->
                    <div class="chapter-card">
                        <div class="chapter-header">
                            <div class="chapter-number">3</div>
                            <div class="chapter-title">Home Sweet Home</div>
                        </div>
                        <div class="chapter-objective">
                            <strong>Tujuan Pembelajaran:</strong> Siswa mampu mendeskripsikan rumah dan ruangan yang ada di dalamnya
                        </div>
                        <div class="chapter-detail-box">
                            <div class="chapter-detail-title"><i class="ph ph-target"></i> Materi Pokok</div>
                            <ul class="chapter-list">
                                <li>Parts of a house</li>
                                <li>Furniture and home appliances</li>
                                <li>Prepositions of place (in, on, under, etc.)</li>
                                <li>There is / There are</li>
                            </ul>
                        </div>
                        <div class="chapter-footer">
                            <span><i class="ph ph-clock" style="color: var(--primary);"></i> 14 JP (7 pertemuan)</span>
                            <span><i class="ph ph-note-pencil" style="color: var(--success);"></i> Menggambar, Deskripsi, Tertulis</span>
                        </div>
                    </div>

                    <!-- Chapter 4 -->
                    <div class="chapter-card">
                        <div class="chapter-header">
                            <div class="chapter-number">4</div>
                            <div class="chapter-title">My School Activities</div>
                        </div>
                        <div class="chapter-objective">
                            <strong>Tujuan Pembelajaran:</strong> Siswa mampu menceritakan kegiatan sehari-hari di sekolah dan rutinitas
                        </div>
                        <div class="chapter-detail-box">
                            <div class="chapter-detail-title"><i class="ph ph-target"></i> Materi Pokok</div>
                            <ul class="chapter-list">
                                <li>Daily activities at school</li>
                                <li>School subjects and facilities</li>
                                <li>Telling time</li>
                                <li>Simple Present Tense for routines</li>
                                <li>Adverbs of frequency (always, usually, etc.)</li>
                            </ul>
                        </div>
                        <div class="chapter-footer">
                            <span><i class="ph ph-clock" style="color: var(--primary);"></i> 14 JP (7 pertemuan)</span>
                            <span><i class="ph ph-note-pencil" style="color: var(--success);"></i> Jadwal, Cerita, Dialog</span>
                        </div>
                    </div>

                    <!-- Chapter 5 -->
                    <div class="chapter-card">
                        <div class="chapter-header">
                            <div class="chapter-number">5</div>
                            <div class="chapter-title">My Uncle is a Zookeeper</div>
                        </div>
                        <div class="chapter-objective">
                            <strong>Tujuan Pembelajaran:</strong> Siswa mampu menyebutkan dan mendeskripsikan berbagai jenis pekerjaan serta hewan
                        </div>
                        <div class="chapter-detail-box">
                            <div class="chapter-detail-title"><i class="ph ph-target"></i> Materi Pokok</div>
                            <ul class="chapter-list">
                                <li>Jobs and professions</li>
                                <li>Animals and their characteristics</li>
                                <li>Describing people's jobs</li>
                                <li>Simple Present Tense (He/She works as...)</li>
                                <li>Descriptive adjectives</li>
                            </ul>
                        </div>
                        <div class="chapter-footer">
                            <span><i class="ph ph-clock" style="color: var(--primary);"></i> 14 JP (7 pertemuan)</span>
                            <span><i class="ph ph-note-pencil" style="color: var(--success);"></i> Presentasi, Deskripsi, Proyek</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Jadwal -->
            <section id="jadwal" class="content-section">
                <div class="section-title"><i class="ph ph-calendar-check"></i> Jadwal Mengajar</div>
                <div class="card no-print">
                    <button class="btn btn-primary" onclick="openJadwalForm()"><i class="ph ph-lock-key"></i> Buka Form Tambah Jadwal</button>
                </div>
                <div id="jadwal-input-wrapper" class="card hidden">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px;">
                        <h3 style="margin:0;"><i class="ph ph-plus-circle"></i> Tambah Jadwal Baru</h3>
                        <button class="btn btn-secondary" onclick="closeJadwalForm()" style="padding:8px 16px; font-size:0.85rem;">Tutup Form</button>
                    </div>
                    <form id="form-jadwal">
                        <div class="jadwal-grid">
                            <div class="form-group"><label class="form-label">Tahun Pelajaran</label><select id="jadwal-tahun" class="form-select" required></select></div>
                            <div class="form-group"><label class="form-label">Semester</label><select id="jadwal-semester" class="form-select" required><option value="Ganjil">Ganjil</option><option value="Genap">Genap</option></select></div>
                            <div class="form-group"><label class="form-label">Hari</label><select id="jadwal-hari" class="form-select" required><option value="Senin">Senin</option><option value="Selasa">Selasa</option><option value="Rabu">Rabu</option><option value="Kamis">Kamis</option><option value="Jumat">Jumat</option><option value="Sabtu">Sabtu</option></select></div>
                            <div class="form-group" style="grid-column: span 2;"><label class="form-label">Jam Ke</label><div class="jam-checkbox-container" id="jam-jadwal-container"></div></div>
                            <div class="form-group" style="grid-column: span 2;"><label class="form-label">Waktu</label><div id="container-jadwal-waktu" class="jam-checkbox-container"></div></div>
                            <div class="form-group"><label class="form-label">Kelas</label><select id="jadwal-kelas" class="form-select" required><option value="71">71</option><option value="72">72</option><option value="73">73</option><option value="74">74</option><option value="75">75</option><option value="76">76</option></select></div>
                            <div class="form-group"><label class="form-label">Mata Pelajaran</label><select id="jadwal-mapel" class="form-select" required><option value="Bahasa Inggris">Bahasa Inggris</option></select></div>
                        </div>
                        <div style="text-align: right; margin-top: 10px;"><button type="submit" class="btn btn-primary"><i class="ph ph-floppy-disk"></i> Simpan Jadwal</button></div>
                    </form>
                </div>
                <div class="card no-print">
                    <div style="display: flex; gap: 12px; flex-wrap: wrap; align-items: center;">
                        <label style="color:var(--text-muted); font-size: 0.9rem;">Filter:</label>
                        <select id="tahun-filter" class="form-select" style="width: auto; padding: 10px 14px;"></select>
                        <select id="semester-filter" class="form-select" style="width: auto; padding: 10px 14px;"><option value="Ganjil">Ganjil</option><option value="Genap">Genap</option></select>
                        <button class="btn btn-secondary" onclick="loadScheduleData()"><i class="ph ph-arrows-clockwise"></i></button>
                    </div>
                </div>
                <div id="jadwal-content" class="card"><p style="text-align: center; color: var(--text-muted);">Memuat jadwal...</p></div>
            </section>

            <!-- Bahan Ajar -->
            <section id="bahan-ajar" class="content-section">
                <div class="section-title"><i class="ph ph-desktop"></i> Bahan Ajar</div>
                <div id="password-overlay-bahan" class="modal-overlay">
                    <div class="modal-card">
                        <i class="ph ph-lock-key" style="font-size: 3rem; color: var(--primary); margin-bottom: 15px;"></i>
                        <h3>Akses Form Bahan Ajar</h3>
                        <input type="password" id="pw-bahan" class="form-input password-input" placeholder="****">
                        <div class="modal-actions">
                            <button class="btn btn-secondary" onclick="closeModal('password-overlay-bahan')">Batal</button>
                            <button class="btn btn-primary" onclick="checkPw('pw-bahan', 'password-overlay-bahan')">Buka</button>
                        </div>
                    </div>
                </div>
                <div class="card no-print"><button class="btn btn-primary" onclick="openBahanForm()"><i class="ph ph-lock-key"></i> Buka Form Tambah Bahan</button></div>
                <div id="bahan-form-wrapper" class="card hidden">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px;">
                        <h3 style="margin:0;"><i class="ph ph-plus-circle"></i> Tambah Bahan Ajar Baru</h3>
                        <button class="btn btn-secondary" onclick="closeBahanForm()" style="padding:8px 16px; font-size:0.85rem;">Tutup Form</button>
                    </div>
                    <form id="form-bahan">
                        <div class="form-group"><label class="form-label">Judul Materi</label><input type="text" id="ba-judul" class="form-input" required></div>
                        <div class="form-group"><label class="form-label">Link / URL Materi</label><input type="url" id="ba-link" class="form-input" required></div>
                        <div class="form-group"><label class="form-label">Deskripsi Singkat</label><textarea id="ba-desc" class="form-textarea" rows="2" required></textarea></div>
                        <!-- DIPERBAIKI: Menambahkan ID ke tombol submit -->
                        <div style="text-align: right;"><button type="submit" id="btn-submit-bahan" class="btn btn-primary"><i class="ph ph-upload"></i> Simpan</button></div>
                    </form>
                </div>
                <div class="card">
                    <h3><i class="ph ph-books"></i> Daftar Materi Tersimpan</h3>
                    <div id="list-bahan-container" class="bahan-grid"><p style="color:var(--text-muted); grid-column: 1/-1; text-align:center;">Memuat data...</p></div>
                </div>
            </section>

            <!-- Jurnal -->
            <section id="jurnal" class="content-section">
                <div class="section-title"><i class="ph ph-notebook"></i> Jurnal Kelas dan Absensi</div>
                <div class="tab-nav no-print">
                    <button class="nav-btn" onclick="askPasswordForJurnal(this, 'jurnal-input')"><i class="ph ph-pencil-simple"></i> Input Jurnal</button>
                    <button class="nav-btn" onclick="switchTab(this, 'jurnal-rekap')">Rekap Jurnal</button>
                    <button class="nav-btn" onclick="switchTab(this, 'absen-rekap')">Rekap Absen</button>
                </div>
                <div id="password-overlay-jurnal" class="modal-overlay">
                    <div class="modal-card">
                        <i class="ph ph-lock-key" style="font-size: 3rem; color: var(--primary); margin-bottom: 15px;"></i>
                        <h3>Akses Input Jurnal</h3>
                        <input type="password" id="pw-jurnal" class="form-input password-input" placeholder="****">
                        <div class="modal-actions">
                            <button class="btn btn-secondary" onclick="closeModal('password-overlay-jurnal')">Batal</button>
                            <button class="btn btn-primary" onclick="checkPw('pw-jurnal', 'password-overlay-jurnal')">Buka</button>
                        </div>
                    </div>
                </div>
                <div id="jurnal-input" class="tab-pane hidden">
                    <form id="form-jurnal">
                        <div class="card">
                            <h3><i class="ph ph-pencil-simple"></i> Data Jurnal</h3>
                            <div class="jadwal-grid">
                                <div class="form-group"><label class="form-label">Tanggal</label><input type="date" id="j-tanggal" class="form-input" required></div>
                                <div class="form-group"><label class="form-label">Kelas</label><select id="j-kelas" class="form-select" onchange="loadSiswa('j-kelas', 'list-absen')" required><option value="">Pilih Kelas</option><option value="71">71</option><option value="72">72</option><option value="73">73</option><option value="74">74</option><option value="75">75</option><option value="76">76</option></select></div>
                            </div>
                            <div class="form-group"><label class="form-label">Jam Ke</label><div class="jam-checkbox-container" id="jam-jurnal-container"></div></div>
                            <div class="form-group"><label class="form-label">Materi Pokok</label><input type="text" id="j-materi" class="form-input" required></div>
                            <div class="form-group"><label class="form-label">Kegiatan Pembelajaran</label><textarea id="j-kegiatan" class="form-textarea" rows="3" required></textarea></div>
                        </div>
                        <div class="card">
                            <h3><i class="ph ph-users"></i> Absensi Siswa</h3>
                            <div id="list-absen" class="student-list-container"><p style="text-align: center; color: var(--text-muted); padding: 20px;">Pilih kelas.</p></div>
                        </div>
                        <div style="text-align: right;"><button type="submit" id="btn-submit-jurnal" class="btn btn-primary"><i class="ph ph-paper-plane-right"></i> Kirim</button></div>
                    </form>
                </div>
                <div id="jurnal-rekap" class="tab-pane hidden">
                    <div class="card no-print" style="text-align: right;"><button class="btn btn-secondary" onclick="loadRekap('Jurnal', 'rekap-jurnal-body')"><i class="ph ph-arrows-clockwise"></i> Refresh</button></div>
                    <div id="rekap-jurnal-body" class="card"></div>
                </div>
                <div id="absen-rekap" class="tab-pane hidden">
                    <div class="card no-print" style="text-align: right;"><button class="btn btn-secondary" onclick="loadRekap('Absensi', 'rekap-absen-body')"><i class="ph ph-arrows-clockwise"></i> Refresh</button></div>
                    <div id="rekap-absen-body" class="card"><p style="text-align: center; color: var(--text-muted);">Tekan refresh.</p></div>
                </div>
            </section>

            <!-- Asesmen -->
            <section id="asesmen" class="content-section">
                <div class="section-title"><i class="ph ph-clipboard-text"></i> Asesmen Pembelajaran</div>
                <div class="card">
                    <h3><i class="ph ph-desktop"></i> Akses CBT</h3>
                    <div style="text-align: center; margin-top: 20px;"><a href="https://edithiasalatin53-del.github.io/Online-Test-System/" target="_blank" rel="noopener noreferrer" class="btn btn-primary"><i class="ph ph-export"></i> Buka Online Test System</a></div>
                </div>
            </section>

            <!-- Nilai -->
            <section id="buku-nilai" class="content-section">
                <div class="section-title"><i class="ph ph-exam"></i> Buku Nilai</div>
                <div class="tab-nav no-print">
                    <button class="nav-btn active" onclick="askPasswordForNilai(this, 'nilai-input')"><i class="ph ph-pencil-simple"></i> Input Nilai</button>
                    <button class="nav-btn" onclick="switchTab(this, 'nilai-rekap')">Rekap Nilai</button>
                </div>
                <div id="password-overlay-nilai" class="modal-overlay">
                    <div class="modal-card">
                        <i class="ph ph-lock-key" style="font-size: 3rem; color: var(--primary); margin-bottom: 15px;"></i>
                        <h3>Akses Input Nilai</h3>
                        <input type="password" id="pw-nilai" class="form-input password-input" placeholder="****">
                        <div class="modal-actions">
                            <button class="btn btn-secondary" onclick="closeModal('password-overlay-nilai')">Batal</button>
                            <button class="btn btn-primary" onclick="checkPw('pw-nilai', 'password-overlay-nilai')">Buka</button>
                        </div>
                    </div>
                </div>
                <div id="nilai-input" class="tab-pane hidden">
                    <form id="form-nilai">
                        <div class="card">
                            <h3><i class="ph ph-pencil-simple-line"></i> Metadata</h3>
                            <div class="nilai-meta-grid">
                                <div class="form-group"><label class="form-label">Kelas</label><select id="n-kelas" class="form-select" onchange="loadSiswa('n-kelas', 'list-nilai')" required><option value="">Pilih</option><option value="71">71</option><option value="72">72</option><option value="73">73</option><option value="74">74</option><option value="75">75</option><option value="76">76</option></select></div>
                                <div class="form-group"><label class="form-label">Jenis</label><select id="n-jenis" class="form-select"><option value="Tugas">Tugas</option><option value="UH">UH</option><option value="UTS">UTS</option><option value="UAS">UAS</option></select></div>
                                <div class="form-group"><label class="form-label">Materi</label><input type="text" id="n-materi" class="form-input" required></div>
                                <div class="form-group"><label class="form-label">Tanggal</label><input type="date" id="n-tanggal" class="form-input" required></div>
                            </div>
                        </div>
                        <div class="card">
                            <h3><i class="ph ph-list-numbers"></i> Input Nilai</h3>
                            <div id="list-nilai" class="student-list-container"><p style="text-align: center; padding: 20px; color: var(--text-muted);">Pilih kelas.</p></div>
                        </div>
                        <div style="text-align: right;"><button type="submit" id="btn-submit-nilai" class="btn btn-primary"><i class="ph ph-floppy-disk"></i> Simpan</button></div>
                    </form>
                </div>
                <div id="nilai-rekap" class="tab-pane hidden">
                    <div class="card" id="nilai-login-card">
                        <h3><i class="ph ph-identification-card"></i> Cek Nilai</h3>
                        <div class="form-group"><label class="form-label">NIS</label><input type="number" id="input-nis-siswa" class="form-input" placeholder="NIS"></div>
                        <button class="btn btn-primary" onclick="checkNIS()"><i class="ph ph-magnifying-glass"></i> Cari</button>
                    </div>
                    <div id="nilai-rekap-body" class="card hidden"></div>
                </div>
            </section>
            
            <!-- Guru Wali -->
            <section id="guru-wali" class="content-section">
                <div class="section-title"><i class="ph ph-users-three"></i> Guru Wali</div>
                <div class="tab-nav no-print">
                    <button class="nav-btn active" onclick="switchTab(this, 'gw-daftar')">Daftar Siswa</button>
                    <button class="nav-btn" onclick="askPasswordForGWTabs(this, 'gw-mulai')">Mulai Bimbingan</button>
                    <button class="nav-btn" onclick="askPasswordForGWTabs(this, 'gw-data')">Data Bimbingan</button>
                </div>

                <div id="password-overlay-gw" class="modal-overlay">
                    <div class="modal-card">
                        <i class="ph ph-lock-key" style="font-size: 3rem; color: var(--primary); margin-bottom: 15px;"></i>
                        <h3>Akses Guru Wali</h3>
                        <input type="password" id="pw-gw" class="form-input password-input" placeholder="****">
                        <div class="modal-actions">
                            <button class="btn btn-secondary" onclick="closeModal('password-overlay-gw')">Batal</button>
                            <button class="btn btn-primary" onclick="checkPw('pw-gw', 'password-overlay-gw')">Buka</button>
                        </div>
                    </div>
                </div>

                <div id="gw-daftar" class="tab-pane">
                    <div class="card">
                        <h3><i class="ph ph-user-plus"></i> Input Data Siswa Bimbingan</h3>
                        <form id="form-gw-tambah">
                            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-bottom:18px;">
                                <input type="text" id="gw-nama" class="form-input" placeholder="Nama Siswa" required>
                                <select id="gw-kelas" class="form-select" required>
                                    <option value="">Kelas</option>
                                    <option value="71">71</option><option value="72">72</option><option value="73">73</option>
                                    <option value="74">74</option><option value="75">75</option><option value="76">76</option>
                                </select>
                            </div>
                            <button type="button" class="btn btn-primary" onclick="askPasswordForGW()"><i class="ph ph-plus"></i> Tambah ke Daftar</button>
                        </form>
                    </div>
                    <div class="card">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                            <h3 style="margin:0;"><i class="ph ph-list-dashes"></i> Daftar Siswa Bimbingan (Server)</h3>
                            <button class="btn btn-secondary" style="padding:8px 12px; font-size:0.8rem;" onclick="loadBimbinganStudents()"><i class="ph ph-arrows-clockwise"></i> Refresh</button>
                        </div>
                        <div id="gw-list-siswa" style="color: var(--text-muted);">Memuat data...</div>
                    </div>
                </div>

                <div id="gw-mulai" class="tab-pane hidden">
                    <div class="card">
                        <h3><i class="ph ph-chat-text"></i> Formulir Bimbingan</h3>
                        <form id="form-gw-bimbingan">
                            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                                <div class="form-group"><label class="form-label">Tanggal</label><input type="date" id="gw-tanggal" class="form-input" required></div>
                                <div class="form-group"><label class="form-label">Jam</label><input type="time" id="gw-jam" class="form-input" required></div>
                            </div>
                            <div class="form-group"><label class="form-label">Nama Siswa</label><select id="gw-nama-siswa" class="form-select" required><option value="">-- Pilih Siswa --</option></select></div>
                            <div class="form-group"><label class="form-label">Jenis Bimbingan</label><select id="gw-jenis" class="form-select" required><option value="">-- Pilih --</option><option value="Pendampingan Akademik">Pendampingan Akademik</option><option value="Pengembangan Kompetensi">Pengembangan Kompetensi</option><option value="Pembentukan Karakter">Pembentukan Karakter</option><option value="Masalah Pribadi">Masalah Pribadi</option></select></div>
                            <div class="form-group"><label class="form-label">Catatan</label><textarea id="gw-catatan" class="form-textarea" rows="3" required></textarea></div>
                            <div class="form-group"><label class="form-label">Status</label><select id="gw-status" class="form-select" required><option value="Selesai">Selesai</option><option value="Perlu Perhatian">Perlu Perhatian</option><option value="Tindak Lanjut">Tindak Lanjut</option></select></div>
                            <button type="submit" class="btn btn-primary"><i class="ph ph-check-circle"></i> Simpan</button>
                        </form>
                    </div>
                </div>

                <div id="gw-data" class="tab-pane hidden">
                    <div class="card no-print" style="text-align: right;"><button class="btn btn-secondary" onclick="loadRekap('Bimbingan', 'rekap-gw-body')"><i class="ph ph-arrows-clockwise"></i> Refresh</button></div>
                    <div id="rekap-gw-body" class="card"><p style="text-align: center; color: var(--text-muted);">Tekan refresh.</p></div>
                </div>
            </section>
        </main>
    </div>

    <div id="password-overlay-jadwal" class="modal-overlay">
        <div class="modal-card">
            <i class="ph ph-lock-key" style="font-size: 3rem; color: var(--primary); margin-bottom: 15px;"></i>
            <h3>Akses Form Tambah Jadwal</h3>
            <input type="password" id="pw-jadwal" class="form-input password-input" placeholder="****">
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal('password-overlay-jadwal')">Batal</button>
                <button class="btn btn-primary" onclick="checkPw('pw-jadwal', 'password-overlay-jadwal')">Buka</button>
            </div>
        </div>
    </div>

    <div id="confirm-modal" class="modal-overlay">
        <div class="modal-card">
            <i class="ph ph-warning-circle" style="font-size: 3rem; color: var(--warning); margin-bottom: 15px;"></i>
            <h3>Konfirmasi</h3>
            <p id="confirm-message" style="color: var(--text-muted); margin-bottom: 25px;">Yakin?</p>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeConfirmModal(false)">Batal</button>
                <button class="btn btn-danger" id="confirm-btn-yes">Ya</button>
            </div>
        </div>
    </div>

    <div id="toast-container"></div>

    <script>
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwspzrPIZzb-DETtzp8nctjQkvooGiRgS5CZ53d73YZFh-ugWbSwGOfj0-J_Gh89D_j/exec'; 
        const PASSWORD = "OmGuru25"; 
        
        let studentsCache = {}; 
        let bimbinganStudents = [];
        let bahanAjarList = [];
        let pendingJurnalTab = null;
        let pendingGWTab = null;
        let pendingNilaiTab = null; 

        let confirmCallback = null;

        function showConfirm(message, callback) {
            document.getElementById('confirm-message').innerText = message;
            document.getElementById('confirm-modal').classList.add('active');
            confirmCallback = callback;
        }

        function closeConfirmModal(result) {
            document.getElementById('confirm-modal').classList.remove('active');
            if (result && confirmCallback) confirmCallback();
            confirmCallback = null;
        }
        document.getElementById('confirm-btn-yes').addEventListener('click', function() { closeConfirmModal(true); });

        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date();
            document.getElementById('current-day').innerText = today.toLocaleDateString('id-ID', { weekday: 'long' });
            document.getElementById('current-date').innerText = today.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
            const isoDate = today.toISOString().split('T')[0];
            
            var jTanggal = document.getElementById('j-tanggal');
            var nTanggal = document.getElementById('n-tanggal');
            var gwTanggal = document.getElementById('gw-tanggal');
            var gwJam = document.getElementById('gw-jam');
            
            if(jTanggal) jTanggal.value = isoDate;
            if(nTanggal) nTanggal.value = isoDate;
            if(gwTanggal) gwTanggal.value = isoDate;
            if(gwJam) gwJam.value = String(today.getHours()).padStart(2, '0') + ':' + String(today.getMinutes()).padStart(2, '0');
            
            renderBahanAjarList(); // Load dari server saat startup

            var tahunSelects = [document.getElementById('jadwal-tahun'), document.getElementById('tahun-filter')];
            tahunSelects.forEach(function(select) {
                if(select) {
                    for (var y = 2025; y <= 2045; y++) {
                        var opt = document.createElement('option');
                        opt.value = y + '/' + (y+1);
                        opt.textContent = y + '/' + (y+1);
                        select.appendChild(opt);
                    }
                }
            });

            generateCheckboxes('jam-jadwal-container', 'jadwal-jam');
            generateWaktuCheckboxes('container-jadwal-waktu', 'jadwal-waktu');
            generateCheckboxes('jam-jurnal-container', 'jam');
            
            loadBimbinganStudents();
        });

        function generateCheckboxes(containerId, name) {
            var container = document.getElementById(containerId);
            if(!container) return;
            container.innerHTML = ''; 
            for(var i = 1; i <= 10; i++) {
                var label = document.createElement('label');
                label.className = 'jam-checkbox-label';
                label.innerHTML = '<input type="checkbox" name="' + name + '" value="' + i + '"><span>Ke-' + i + '</span>';
                container.appendChild(label);
            }
        }

        function generateWaktuCheckboxes(containerId, name) {
            var container = document.getElementById(containerId);
            if(!container) return;
            var waktuOptions = ["07.15 - 07.55", "07.55 - 08.35", "08.35 - 09.15", "09.15 - 09.55", "09.55 - 10.20", "10.20 - 11.00", "11.00 - 11.40", "12.50 - 13.30", "13.30 - 14.10", "14.10 - 14.50"];
            container.innerHTML = '';
            waktuOptions.forEach(function(w) {
                var label = document.createElement('label');
                label.className = 'jam-checkbox-label';
                label.innerHTML = '<input type="checkbox" name="' + name + '" value="' + w + '"><span>' + w + '</span>';
                container.appendChild(label);
            });
        }

        function showToast(message, type) {
            type = type || 'success';
            var container = document.getElementById('toast-container');
            var toast = document.createElement('div');
            toast.className = 'toast ' + type;
            var icon = type === 'success' ? 'check-circle' : (type === 'info' ? 'info' : 'warning-circle');
            toast.innerHTML = '<div style="display:flex; align-items:center; gap:12px;"><i class="ph ph-' + icon + '" style="font-size:1.2rem;"></i><span>' + message + '</span></div>';
            container.appendChild(toast);
            setTimeout(function() { 
                toast.style.animation = 'slideInRight 0.3s ease reverse forwards'; 
                setTimeout(function() { toast.remove(); }, 300); 
            }, 3000);
        }

        function showSection(id, btn) {
            var sections = document.querySelectorAll('.content-section');
            for(var i = 0; i < sections.length; i++) {
                sections[i].classList.remove('active');
            }
            document.getElementById(id).classList.add('active');
            var navBtns = document.querySelectorAll('nav .nav-btn');
            for(var j = 0; j < navBtns.length; j++) {
                navBtns[j].classList.remove('active');
            }
            if(btn) btn.classList.add('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });

            if(id === 'jurnal') {
                var rekapAbsenBtns = document.querySelectorAll('#jurnal .tab-nav button');
                for(var k = 0; k < rekapAbsenBtns.length; k++) {
                    if(rekapAbsenBtns[k].getAttribute('onclick') && rekapAbsenBtns[k].getAttribute('onclick').indexOf('absen-rekap') !== -1) {
                        switchTab(rekapAbsenBtns[k], 'absen-rekap');
                        break;
                    }
                }
                closeModal('password-overlay-jurnal');
            }
            if(id === 'buku-nilai') { 
                var nilaiBtns = document.querySelectorAll('#buku-nilai .tab-nav button');
                if(nilaiBtns.length > 0) switchTab(nilaiBtns[0], 'nilai-rekap'); 
                closeModal('password-overlay-nilai'); 
            }
            if(id === 'guru-wali') { 
                var gwBtns = document.querySelectorAll('#guru-wali .tab-nav button');
                if(gwBtns.length > 0) switchTab(gwBtns[0], 'gw-daftar'); 
                closeModal('password-overlay-gw'); 
                loadBimbinganStudents(); 
            }
            if(id === 'jadwal') loadScheduleData(); 
            if(id === 'bahan-ajar') renderBahanAjarList();
        }

        function switchTab(btn, tabId) {
            var parent = btn.parentElement;
            var siblings = parent.querySelectorAll('.nav-btn');
            for(var i = 0; i < siblings.length; i++) {
                siblings[i].classList.remove('active');
            }
            if(btn) btn.classList.add('active');
            var container = btn.closest('.content-section');
            var panes = container.querySelectorAll('.tab-pane');
            for(var j = 0; j < panes.length; j++) {
                panes[j].classList.add('hidden');
            }
            document.getElementById(tabId).classList.remove('hidden');
            var modals = container.querySelectorAll('.modal-overlay');
            for(var k = 0; k < modals.length; k++) {
                modals[k].classList.remove('active');
            }
            if(tabId === 'nilai-rekap') { 
                document.getElementById('nilai-login-card').classList.remove('hidden'); 
                document.getElementById('nilai-rekap-body').classList.add('hidden'); 
            }
        }

        // Password Logic
        function askPasswordForJurnal(btn, tabId) { 
            pendingJurnalTab = { btn: btn, tabId: tabId }; 
            document.getElementById('pw-jurnal').value = ''; 
            document.getElementById('password-overlay-jurnal').classList.add('active'); 
            setTimeout(function() { document.getElementById('pw-jurnal').focus(); }, 100); 
        }
        function askPasswordForNilai(btn, tabId) { 
            pendingNilaiTab = { btn: btn, tabId: tabId }; 
            document.getElementById('pw-nilai').value = ''; 
            document.getElementById('password-overlay-nilai').classList.add('active'); 
            setTimeout(function() { document.getElementById('pw-nilai').focus(); }, 100); 
        }
        function askPasswordForGWTabs(btn, tabId) { 
            pendingGWTab = { btn: btn, tabId: tabId }; 
            document.getElementById('pw-gw').value = ''; 
            document.getElementById('password-overlay-gw').classList.add('active'); 
            setTimeout(function() { document.getElementById('pw-gw').focus(); }, 100); 
        }
        function askPasswordForGW() { 
            if(!document.getElementById('gw-nama').value || !document.getElementById('gw-kelas').value) { 
                showToast("Isi Nama dan Kelas!", "error"); 
                return; 
            } 
            document.getElementById('pw-gw').value = ''; 
            document.getElementById('password-overlay-gw').classList.add('active'); 
            setTimeout(function() { document.getElementById('pw-gw').focus(); }, 100); 
        }
        function openJadwalForm() { 
            document.getElementById('pw-jadwal').value = ''; 
            document.getElementById('password-overlay-jadwal').classList.add('active'); 
            setTimeout(function() { document.getElementById('pw-jadwal').focus(); }, 100); 
        }
        function closeJadwalForm() { document.getElementById('jadwal-input-wrapper').classList.add('hidden'); }
        function openBahanForm() { 
            document.getElementById('pw-bahan').value = ''; 
            document.getElementById('password-overlay-bahan').classList.add('active'); 
            setTimeout(function() { document.getElementById('pw-bahan').focus(); }, 100); 
        }
        function closeBahanForm() { document.getElementById('bahan-form-wrapper').classList.add('hidden'); }
        function closeModal(modalId) { document.getElementById(modalId).classList.remove('active'); }

        function checkPw(inputId, modalId) {
            if(document.getElementById(inputId).value === PASSWORD) {
                closeModal(modalId);
                if(modalId === 'password-overlay-jurnal' && pendingJurnalTab) { 
                    switchTab(pendingJurnalTab.btn, pendingJurnalTab.tabId); 
                    pendingJurnalTab = null; 
                }
                if(modalId === 'password-overlay-nilai' && pendingNilaiTab) { 
                    switchTab(pendingNilaiTab.btn, pendingNilaiTab.tabId); 
                    pendingNilaiTab = null; 
                }
                if(modalId === 'password-overlay-bahan') { 
                    document.getElementById('bahan-form-wrapper').classList.remove('hidden'); 
                }
                if(modalId === 'password-overlay-gw') { 
                    if(pendingGWTab) { 
                        switchTab(pendingGWTab.btn, pendingGWTab.tabId); 
                        pendingGWTab = null; 
                    } else { 
                        submitGWTambah(); 
                    } 
                }
                if(modalId === 'password-overlay-jadwal') { 
                    document.getElementById('jadwal-input-wrapper').classList.remove('hidden'); 
                }
                showToast("Akses Diberikan", "success");
            } else { 
                showToast("Password Salah!", "error"); 
                var modalCard = document.querySelector('#' + modalId + ' .modal-card');
                modalCard.style.animation = "shake 0.4s"; 
                setTimeout(function() { modalCard.style.animation = ""; }, 400); 
            }
        }

        function checkNIS() {
            var nisInput = document.getElementById('input-nis-siswa').value;
            if(!nisInput) { showToast("Masukkan NIS", "error"); return; }
            document.getElementById('nilai-rekap-body').innerHTML = '<p style="text-align:center;"><i class="ph ph-spinner ph-spin" style="font-size:1.5rem; color:var(--primary)"></i></p>';
            fetch(WEB_APP_URL + '?action=getData&sheetName=Data_Nilai')
            .then(function(res) { return res.json(); })
            .then(function(response) {
                var studentData = [];
                var data = response.data || [];
                for(var i = 0; i < data.length; i++) {
                    if(data[i][0] && data[i][0].toString() === nisInput) {
                        studentData.push(data[i]);
                    }
                }
                if(studentData.length > 0) {
                    document.getElementById('nilai-login-card').classList.add('hidden');
                    document.getElementById('nilai-rekap-body').classList.remove('hidden');
                    renderTableFromData(studentData, 'nilai-rekap-body', true);
                } else { 
                    showToast("Data tidak ditemukan", "error"); 
                }
            }).catch(function(err) { showToast("Error", "error"); });
        }

                function loadSiswa(selectId, targetId) {
            var kelas = document.getElementById(selectId).value;
            var div = document.getElementById(targetId);
            if(!kelas) return;
            div.innerHTML = '<p style="text-align:center; padding: 20px;"><i class="ph ph-spinner ph-spin"></i></p>';
            
            fetch(WEB_APP_URL + '?action=getData&sheetName=Data_Siswa')
            .then(function(res) { return res.json(); })
            .then(function(response) {
                var flatData = response.data || [];
                studentsCache[kelas] = []; 
                if (flatData.length > 0) {
                    var headerRow = flatData[0];
                    
                    // Cari index kolom penting secara dinamis
                    var nisIdx = headerRow.findIndex(function(cell) { return String(cell).toUpperCase().trim() === "NIS"; });
                    var nameIdx = headerRow.findIndex(function(cell) { return String(cell).toUpperCase().trim() === "NAMA"; });
                    var classIdx = headerRow.findIndex(function(cell) { return String(cell).toUpperCase().trim() === "KELAS"; });
                    
                    // Fallback jika tidak ketemu
                    if(nisIdx === -1) nisIdx = 0; // Kolom pertama biasanya NIS
                    if(nameIdx === -1) nameIdx = 1; 
                    if(classIdx === -1) classIdx = 2;
                    
                    for(var i = 1; i < flatData.length; i++) {
                        var row = flatData[i];
                        if(!row || row.length === 0) continue;
                        var nis = row[nisIdx];
                        var nama = row[nameIdx];
                        var klsRaw = row[classIdx];
                        if (nama && klsRaw) {
                            var klsNormalized = String(klsRaw).replace(/\./g, '').replace(/\s/g, '').replace(/-/g, '');
                            if(!studentsCache[klsNormalized]) studentsCache[klsNormalized] = [];
                            // SIMPAN NIS DAN NAMA
                            studentsCache[klsNormalized].push({NIS: nis, NAMA: nama});
                        }
                    }
                }
                if(studentsCache[kelas] && studentsCache[kelas].length > 0) {
                    renderSiswaList(div, targetId, studentsCache[kelas]);
                } else {
                    div.innerHTML = '<p style="text-align:center; color:var(--danger); padding: 20px;">Data siswa kelas <b>' + kelas + '</b> tidak ditemukan.</p>';
                }
            }).catch(function(err) { 
                console.error(err); 
                div.innerHTML = '<p style="text-align:center; color:var(--danger);">Koneksi gagal.</p>'; 
            });
        }

        function renderSiswaList(div, targetId, data) {
            div.innerHTML = '';
            if(targetId === 'list-absen') {
                for(var i = 0; i < data.length; i++) {
                    var s = data[i];
                    div.innerHTML += '<div class="student-item"><div>' + s.NAMA + '</div><div class="status-group" data-name="' + s.NAMA + '" data-status="Hadir"><button type="button" class="status-btn active-hadir" onclick="setAbsen(this, \'Hadir\')">H</button><button type="button" class="status-btn" onclick="setAbsen(this, \'Sakit\')">S</button><button type="button" class="status-btn" onclick="setAbsen(this, \'Izin\')">I</button><button type="button" class="status-btn" onclick="setAbsen(this, \'Alpa\')">A</button><button type="button" class="status-btn" onclick="setAbsen(this, \'Bolos\')">B</button></div></div>';
                }
            } else if (targetId === 'list-nilai') {
                for(var j = 0; j < data.length; j++) {
                    var s2 = data[j];
                    // TAMBAHKAN DATA-NIS
                    div.innerHTML += '<div class="student-item"><div>' + s2.NAMA + '</div><input type="number" class="form-input score-input" style="width:80px; margin-bottom:0; text-align:center; padding:8px;" data-name="' + s2.NAMA + '" data-nis="' + (s2.NIS || '') + '" placeholder="0"></div>';
                }
            }
            div.innerHTML += '<div class="student-count-footer">Total: ' + data.length + ' Siswa</div>';
        }

        // PERBAIKAN: Cek NIS di kolom yang benar (Kolom Index 5 berdasarkan header GS)
        function checkNIS() {
            var nisInput = document.getElementById('input-nis-siswa').value;
            if(!nisInput) { showToast("Masukkan NIS", "error"); return; }
            document.getElementById('nilai-rekap-body').innerHTML = '<p style="text-align:center;"><i class="ph ph-spinner ph-spin" style="font-size:1.5rem; color:var(--primary)"></i></p>';
            fetch(WEB_APP_URL + '?action=getData&sheetName=Data_Nilai')
            .then(function(res) { return res.json(); })
            .then(function(response) {
                var studentData = [];
                var data = response.data || [];
                
                if(data.length > 0) {
                    // Cari index kolom NIS dari header
                    var header = data[0];
                    var nisColIdx = header.indexOf("NIS"); // Seharusnya index 5
                    
                    // Jika header tidak ada, default ke index 5 (berdasarkan setup GS)
                    if(nisColIdx === -1) nisColIdx = 5;

                    // Loop data mulai baris 1 (lewati header)
                    for(var i = 1; i < data.length; i++) {
                        var row = data[i];
                        // Cek jika kolom NIS ada dan cocok
                        if(row[nisColIdx] && String(row[nisColIdx]) === String(nisInput)) {
                            studentData.push(row);
                        }
                    }
                }

                if(studentData.length > 0) {
                    document.getElementById('nilai-login-card').classList.add('hidden');
                    document.getElementById('nilai-rekap-body').classList.remove('hidden');
                    renderTableFromData(studentData, 'nilai-rekap-body', true);
                } else { 
                    showToast("Data tidak ditemukan", "error"); 
                }
            }).catch(function(err) { showToast("Error", "error"); });
        }

        // PERBAIKAN: Submit Nilai dengan menyertakan NIS
        document.getElementById('form-nilai').addEventListener('submit', function(e) {
            e.preventDefault();
            var btn = document.getElementById('btn-submit-nilai'); 
            btn.disabled = true; 
            btn.innerHTML = '<i class="ph ph-spinner ph-spin"></i>';
            
            var meta = { 
                tanggal: document.getElementById('n-tanggal').value, 
                kelas: document.getElementById('n-kelas').value, 
                jenis: document.getElementById('n-jenis').value, 
                materi: document.getElementById('n-materi').value 
            };
            
            var nilaiData = [];
            var inputs = document.querySelectorAll('.score-input');
            for(var i = 0; i < inputs.length; i++) {
                var input = inputs[i];
                if(input.value !== '') {
                    nilaiData.push({ 
                        nis: input.dataset.nis || "", // KIRIM NIS
                        namaSiswa: input.dataset.name, 
                        nilai: parseFloat(input.value) 
                    });
                }
            }
            
            fetch(WEB_APP_URL, { 
                method: 'POST', 
                mode: 'no-cors', 
                headers: { 'Content-Type': 'application/json' }, 
                body: JSON.stringify({ action: 'submitNilai', tanggal: meta.tanggal, kelas: meta.kelas, jenis: meta.jenis, materi: meta.materi, data: nilaiData }) 
            })
            .then(function() { 
                showToast("Tersimpan!"); 
                btn.disabled = false; 
                btn.innerHTML = '<i class="ph ph-floppy-disk"></i> Simpan'; 
                var scoreInputs = document.querySelectorAll('.score-input');
                for(var j = 0; j < scoreInputs.length; j++) {
                    scoreInputs[j].value = '';
                }
            })
            .catch(function(err) { 
                showToast("Gagal", "error"); 
                btn.disabled = false; 
                btn.innerHTML = '<i class="ph ph-floppy-disk"></i> Simpan'; 
            });
        });

        function setAbsen(btn, status) {
            var parent = btn.parentElement;
            var btns = parent.querySelectorAll('.status-btn');
            for(var i = 0; i < btns.length; i++) {
                btns[i].className = 'status-btn';
            }
            var cls = 'active-hadir';
            if(status === 'Sakit') cls = 'active-sakit';
            if(status === 'Izin') cls = 'active-izin';
            if(status === 'Alpa') cls = 'active-alpa';
            if(status === 'Bolos') cls = 'active-bolos';
            btn.classList.add(cls);
            parent.dataset.status = status;
        }

        // Form Submissions
        document.getElementById('form-jurnal').addEventListener('submit', function(e) {
            e.preventDefault();
            var btn = document.getElementById('btn-submit-jurnal'); 
            btn.disabled = true; 
            btn.innerHTML = '<i class="ph ph-spinner ph-spin"></i>';
            
            var jamChecked = document.querySelectorAll('input[name="jam"]:checked');
            var jamValues = [];
            for(var i = 0; i < jamChecked.length; i++) {
                jamValues.push(jamChecked[i].value);
            }
            
            var jurnalData = { 
                tanggal: document.getElementById('j-tanggal').value, 
                kelas: document.getElementById('j-kelas').value, 
                jamKe: jamValues.join(', '), 
                materiPokok: document.getElementById('j-materi').value, 
                kegiatanPembelajaran: document.getElementById('j-kegiatan').value 
            };
            
            var absensiData = [];
            var statusGroups = document.querySelectorAll('#list-absen .status-group');
            for(var j = 0; j < statusGroups.length; j++) {
                var grp = statusGroups[j];
                absensiData.push({ 
                    tanggal: jurnalData.tanggal, 
                    kelas: jurnalData.kelas, 
                    jamKe: jurnalData.jamKe, 
                    namaSiswa: grp.dataset.name, 
                    status: grp.dataset.status || 'Hadir' 
                });
            }
            
            fetch(WEB_APP_URL, { 
                method: 'POST', 
                mode: 'no-cors', 
                headers: { 'Content-Type': 'application/json' }, 
                body: JSON.stringify({ action: 'submitJurnal', jurnal: jurnalData, absensi: absensiData }) 
            })
            .then(function() { 
                showToast("Terkirim!"); 
                btn.disabled = false; 
                btn.innerHTML = '<i class="ph ph-paper-plane-right"></i> Kirim'; 
                document.getElementById('form-jurnal').reset(); 
                document.getElementById('list-absen').innerHTML = ''; 
            })
            .catch(function(err) { 
                showToast("Gagal", "error"); 
                btn.disabled = false; 
                btn.innerHTML = '<i class="ph ph-paper-plane-right"></i> Kirim'; 
            });
        });

        document.getElementById('form-nilai').addEventListener('submit', function(e) {
            e.preventDefault();
            var btn = document.getElementById('btn-submit-nilai'); 
            btn.disabled = true; 
            btn.innerHTML = '<i class="ph ph-spinner ph-spin"></i>';
            
            var meta = { 
                tanggal: document.getElementById('n-tanggal').value, 
                kelas: document.getElementById('n-kelas').value, 
                jenis: document.getElementById('n-jenis').value, 
                materi: document.getElementById('n-materi').value 
            };
            
            var nilaiData = [];
            var inputs = document.querySelectorAll('.score-input');
            for(var i = 0; i < inputs.length; i++) {
                var input = inputs[i];
                if(input.value !== '') {
                    nilaiData.push({ namaSiswa: input.dataset.name, nilai: parseFloat(input.value) });
                }
            }
            
            fetch(WEB_APP_URL, { 
                method: 'POST', 
                mode: 'no-cors', 
                headers: { 'Content-Type': 'application/json' }, 
                body: JSON.stringify({ action: 'submitNilai', tanggal: meta.tanggal, kelas: meta.kelas, jenis: meta.jenis, materi: meta.materi, data: nilaiData }) 
            })
            .then(function() { 
                showToast("Tersimpan!"); 
                btn.disabled = false; 
                btn.innerHTML = '<i class="ph ph-floppy-disk"></i> Simpan'; 
                var scoreInputs = document.querySelectorAll('.score-input');
                for(var j = 0; j < scoreInputs.length; j++) {
                    scoreInputs[j].value = '';
                }
            })
            .catch(function(err) { 
                showToast("Gagal", "error"); 
                btn.disabled = false; 
                btn.innerHTML = '<i class="ph ph-floppy-disk"></i> Simpan'; 
            });
        });

        // --- GURU WALI LOGIC ---
        
        function submitGWTambah() {
            var name = document.getElementById('gw-nama').value;
            var kelas = document.getElementById('gw-kelas').value;
            if(!name || !kelas) return;

            fetch(WEB_APP_URL, {
                method: 'POST', 
                mode: 'no-cors', 
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    action: 'submitBimbinganMaster',
                    nama: name,
                    kelas: kelas,
                    tanggal: new Date().toISOString().split('T')[0]
                })
            }).then(function() {
                showToast(name + ' ditambahkan ke server.');
                document.getElementById('form-gw-tambah').reset();
                loadBimbinganStudents();
            }).catch(function(err) { 
                showToast("Gagal menyimpan", "error"); 
            });
        }

        function loadBimbinganStudents() {
            var div = document.getElementById('gw-list-siswa');
            var select = document.getElementById('gw-nama-siswa');
            
            div.innerHTML = '<p style="text-align:center;"><i class="ph ph-spinner ph-spin"></i></p>';
            select.innerHTML = '<option value="">-- Memuat --</option>';

            fetch(WEB_APP_URL + '?action=getData&sheetName=Data_Bimbingan')
            .then(function(res) { return res.json(); })
            .then(function(response) {
                var data = response.data || [];
                bimbinganStudents = [];
                
                if(data.length > 0) {
                    var startRow = (String(data[0][0]).toUpperCase() === 'TIMESTAMP') ? 1 : 0;
                    var seen = {};
                    
                    for(var i = startRow; i < data.length; i++) {
                        var row = data[i];
                        var nama = row[3];
                        var kls = row[4];
                        if(nama && kls) {
                            var key = nama + "-" + kls;
                            if(!seen[key]) {
                                bimbinganStudents.push({ name: nama, kelas: kls });
                                seen[key] = true;
                            }
                        }
                    }
                }

                div.innerHTML = '';
                if(bimbinganStudents.length === 0) {
                    div.innerHTML = '<p style="text-align:center; color:var(--text-muted);">Belum ada siswa bimbingan.</p>';
                } else {
                    for(var j = 0; j < bimbinganStudents.length; j++) {
                        var s = bimbinganStudents[j];
                        div.innerHTML += '<div class="student-item"><div><strong>' + s.name + '</strong> <span style="font-size:0.8em; color:var(--text-muted);">(' + s.kelas + ')</span></div></div>';
                    }
                }

                select.innerHTML = '<option value="">-- Pilih Siswa Bimbingan --</option>';
                for(var k = 0; k < bimbinganStudents.length; k++) {
                    var s2 = bimbinganStudents[k];
                    var opt = document.createElement('option');
                    opt.value = JSON.stringify(s2);
                    opt.textContent = s2.name + ' (' + s2.kelas + ')';
                    select.appendChild(opt);
                }
            }).catch(function(err) {
                div.innerHTML = '<p style="text-align:center; color:var(--danger);">Gagal memuat data.</p>';
            });
        }

        document.getElementById('form-gw-bimbingan').addEventListener('submit', function(e) {
            e.preventDefault();
            var studentRaw = document.getElementById('gw-nama-siswa').value;
            if(!studentRaw) { showToast("Pilih siswa dulu!", "error"); return; }
            var studentObj = JSON.parse(studentRaw);
            var btn = e.target.querySelector('button[type="submit"]'); 
            btn.disabled = true; 
            btn.innerHTML = '<i class="ph ph-spinner ph-spin"></i>';

            fetch(WEB_APP_URL, {
                method: 'POST', 
                mode: 'no-cors', 
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    action: 'submitBimbingan',
                    tanggal: document.getElementById('gw-tanggal').value,
                    jam: document.getElementById('gw-jam').value,
                    namaSiswa: studentObj.name,
                    kelas: studentObj.kelas,
                    jenis: document.getElementById('gw-jenis').value,
                    catatan: document.getElementById('gw-catatan').value,
                    status: document.getElementById('gw-status').value
                })
            }).then(function() {
                showToast('Tersimpan!');
                document.getElementById('form-gw-bimbingan').reset();
                var now = new Date();
                document.getElementById('gw-tanggal').valueAsDate = now;
                document.getElementById('gw-jam').value = String(now.getHours()).padStart(2,'0') + ':' + String(now.getMinutes()).padStart(2,'0');
                btn.disabled = false; 
                btn.innerHTML = '<i class="ph ph-check-circle"></i> Simpan';
            }).catch(function(err) { 
                showToast("Gagal", "error"); 
                btn.disabled = false; 
                btn.innerHTML = '<i class="ph ph-check-circle"></i> Simpan'; 
            });
        });

        // --- BAHAN AJAR (FIXED) ---
        document.getElementById('form-bahan').addEventListener('submit', function(e) {
            e.preventDefault();
            var btn = document.getElementById('btn-submit-bahan'); 
            btn.disabled = true; 
            btn.innerHTML = '<i class="ph ph-spinner ph-spin"></i>';

            fetch(WEB_APP_URL, { 
                method: 'POST', 
                mode: 'no-cors', 
                headers: { 'Content-Type': 'application/json' }, 
                body: JSON.stringify({ 
                    action: 'submitBahanAjar', 
                    judul: document.getElementById('ba-judul').value, 
                    link: document.getElementById('ba-link').value, 
                    desc: document.getElementById('ba-desc').value, 
                    tanggal: new Date().toLocaleDateString('id-ID') 
                }) 
            })
            .then(function() { 
                showToast("Tersimpan ke Server!"); 
                btn.disabled = false; 
                btn.innerHTML = '<i class="ph ph-upload"></i> Simpan'; 
                document.getElementById('form-bahan').reset(); 
                renderBahanAjarList(); 
            })
            .catch(function(err) { 
                showToast("Gagal", "error"); 
                btn.disabled = false; 
                btn.innerHTML = '<i class="ph ph-upload"></i> Simpan'; 
            });
        });

        function renderBahanAjarList() {
            var container = document.getElementById('list-bahan-container');
            container.innerHTML = '<p style="text-align:center; color:var(--text-muted);">Memuat data server...</p>';
            
            fetch(WEB_APP_URL + '?action=getData&sheetName=Data_Bahan_Ajar')
            .then(function(res) { return res.json(); })
            .then(function(response) {
                var data = response.data || [];
                if (data.length <= 1) { // Hanya header
                    container.innerHTML = '<p style="color:var(--text-muted); grid-column: 1/-1; text-align:center;">Belum ada materi.</p>';
                    return;
                }
                
                container.innerHTML = '';
                // Loop mulai dari index 1 (melewati header)
                for(var i = 1; i < data.length; i++) {
                    var item = data[i];
                    // Struktur Data_Bahan_Ajar: Timestamp, Judul, Link, Deskripsi, Tanggal
                    if(item[1]) { // Cek Judul ada
                         container.innerHTML += '<div class="bahan-card"><h4>' + item[1] + '</h4><p>' + (item[3] || '') + '</p><a href="' + item[2] + '" target="_blank" rel="noopener noreferrer" class="btn btn-secondary" style="font-size:0.85rem; margin-top:auto;"><i class="ph ph-link"></i> Buka</a></div>';
                    }
                }
            }).catch(function(err) {
                 container.innerHTML = '<p style="color:var(--danger); grid-column: 1/-1; text-align:center;">Gagal memuat data.</p>';
            });
        }

        // Jadwal
        document.getElementById('form-jadwal').addEventListener('submit', function(e) {
            e.preventDefault();
            var btn = document.querySelector('#jadwal-input-wrapper button[type="submit"]'); 
            btn.disabled = true; 
            btn.innerHTML = '<i class="ph ph-spinner ph-spin"></i>';
            
            var jamChecked = document.querySelectorAll('input[name="jadwal-jam"]:checked');
            var jamValues = [];
            for(var i = 0; i < jamChecked.length; i++) {
                jamValues.push(jamChecked[i].value);
            }
            
            var waktuChecked = document.querySelectorAll('input[name="jadwal-waktu"]:checked');
            var waktuValues = [];
            for(var j = 0; j < waktuChecked.length; j++) {
                waktuValues.push(waktuChecked[j].value);
            }
            
            var jadwalData = { 
                tahun: document.getElementById('jadwal-tahun').value, 
                semester: document.getElementById('jadwal-semester').value, 
                hari: document.getElementById('jadwal-hari').value, 
                jamKe: jamValues.join(', '), 
                waktu: waktuValues.join(', '), 
                kelas: document.getElementById('jadwal-kelas').value, 
                mapel: document.getElementById('jadwal-mapel').value 
            };
            
            fetch(WEB_APP_URL, { 
                method: 'POST', 
                mode: 'no-cors', 
                headers: { 'Content-Type': 'application/json' }, 
                body: JSON.stringify({ action: 'addJadwal', data: jadwalData }) 
            })
            .then(function() { 
                showToast("Tersimpan!"); 
                btn.disabled = false; 
                btn.innerHTML = '<i class="ph ph-floppy-disk"></i> Simpan'; 
                document.getElementById('form-jadwal').reset(); 
                loadScheduleData(); 
            })
            .catch(function(err) { 
                showToast("Gagal", "error"); 
                btn.disabled = false; 
                btn.innerHTML = '<i class="ph ph-floppy-disk"></i> Simpan'; 
            });
        });

        function loadScheduleData() {
            var div = document.getElementById('jadwal-content');
            var filterTahun = document.getElementById('tahun-filter').value;
            var filterSem = document.getElementById('semester-filter').value;
            div.innerHTML = '<p style="text-align:center;"><i class="ph ph-spinner ph-spin"></i></p>';
            fetch(WEB_APP_URL + '?action=getData&sheetName=Jadwal')
            .then(function(res) { return res.json(); })
            .then(function(response) {
                var dataRows = [];
                if(response.data && response.data.length > 0) {
                    if(response.data[0] && response.data[0][0] === 'Timestamp') {
                        dataRows = response.data.slice(1);
                    } else {
                        dataRows = response.data;
                    }
                }
                
                var filteredRows = [];
                for(var i = 0; i < dataRows.length; i++) {
                    if(dataRows[i][1] === filterTahun && dataRows[i][2] === filterSem) {
                        filteredRows.push(dataRows[i]);
                    }
                }
                
                var html = '<div class="table-container"><table><thead><tr><th>Hari</th><th>Jam</th><th>Waktu</th><th>Kelas</th><th>Mapel</th></tr></thead><tbody>';
                for(var j = 0; j < filteredRows.length; j++) {
                    var r = filteredRows[j];
                    html += '<tr><td>' + (r[3] || '-') + '</td><td>' + (r[4] || '-') + '</td><td>' + (r[5] || '-') + '</td><td>' + (r[6] || '-') + '</td><td>' + (r[7] || '-') + '</td></tr>';
                }
                html += '</tbody></table></div>';
                div.innerHTML = html;
            }).catch(function(err) { 
                div.innerHTML = '<p style="text-align:center">Gagal.</p>'; 
            });
        }

        function loadRekap(type, targetId) {
            var div = document.getElementById(targetId);
            div.innerHTML = '<p style="text-align:center;"><i class="ph ph-spinner ph-spin"></i></p>';
            fetch(WEB_APP_URL + '?action=getData&sheetName=Data_' + type)
            .then(function(res) { return res.json(); })
            .then(function(response) {
                if(response.data && response.data.length > 0) {
                    renderTableFromData(response.data, targetId);
                } else {
                    div.innerHTML = '<p style="text-align:center; color:var(--text-muted)">Kosong.</p>';
                }
            }).catch(function(err) { 
                div.innerHTML = '<p style="text-align:center">Error.</p>'; 
            });
        }

        function renderTableFromData(values, targetId, isStudentView) {
            var div = document.getElementById(targetId);
            if(!values || values.length === 0) { 
                div.innerHTML = '<p>Kosong.</p>'; 
                return; 
            }
            var html = '<div class="table-container"><table><thead><tr>';
            for(var h = 0; h < values[0].length; h++) {
                html += '<th>' + values[0][h] + '</th>';
            }
            html += '</tr></thead><tbody>';
            for (var i = 1; i < values.length; i++) {
                html += '<tr>';
                for(var j = 0; j < values[i].length; j++) {
                    html += '<td>' + values[i][j] + '</td>';
                }
                html += '</tr>';
            }
            html += '</tbody></table></div>';
            if(isStudentView) {
                html += '<div style="margin-top:20px; text-align:center;"><button class="btn btn-secondary" onclick="document.getElementById(\'nilai-login-card\').classList.remove(\'hidden\'); document.getElementById(\'nilai-rekap-body\').classList.add(\'hidden\');">Kembali</button></div>';
            }
            div.innerHTML = html;
        }
    </script>
</body>
</html>